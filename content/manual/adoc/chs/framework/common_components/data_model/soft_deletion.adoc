:sourcesdir: ../../../../../source

[[soft_deletion]]
===== 软删除

CUBA 框架支持软删除模式，记录并不从数据库中物理删除，而是打上特定的标记，此时常规的方式将不能访问这些记录。后续可以使用某种定时任务将这些记录从数据库中完全删除或恢复。

软删除机制对于应用程序开发人员来说是透明的，唯一的要求是实体类实现 `SoftDelete` 接口。平台将自动调整数据操作。

软删除模式具有以下优点：

* 显著降低因不正确的用户操作而导致数据丢失的风险。

* 可以将某些记录标记为不可访问，即使系统中还存在对这些记录的引用。
+
使用 Orders-Customers 数据模型作为示例，假设某个客户已经下了多个订单，但我们需要禁止用户访问此客户实例。对于传统的硬删除来说，这是不可能的，因为删除客户实例需要删除所有相关订单或在订单中将所有对客户的引用设置为 null（意味着数据丢失）。软删除后，虽然客户实例无法进行搜索和修改，但是用户依然可以在订单编辑中看到客户的名称，因为在获取相关实体时有意忽略了删除属性。
+
上述标准行为可以使用<<delete_policy,关联实体处理策略>>进行修改。

已删除的实体实例可以在应用程序的 *Administration* 菜单中的 *Restore Deleted Entities* 界面上手动恢复。此功能仅适用于对所有实体具有所有操作<<permissions,权限>>的应用程序管理员，并且应该谨慎使用，因此建议拒绝让普通用户访问此界面。

软删除的负面影响是会增加数据库大小，以及可能需要额外的数据清理程序。

include::soft_deletion/soft_deletion_usage.adoc[]

include::soft_deletion/delete_policy.adoc[]

include::soft_deletion/soft_deletion_unique_constr.adoc[]

